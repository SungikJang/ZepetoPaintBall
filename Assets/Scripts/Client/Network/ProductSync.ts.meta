fileFormatVersion: 2
guid: d83ad6c5b971d1948be8786e1faa3875
importerOverride: ZEPETO.Script.Compiler:ZEPETO.Script:TypescriptAssetImporter
ScriptedImporter:
  internalIDToNameTable: []
  externalObjects: {}
  serializedVersion: 2
  userData: 
  assetBundleName: 
  assetBundleVariant: 
  script: {fileID: -1123457745, guid: 54cf806323ffe4418a4ce4cc63fe6b9d, type: 3}
  isAssemblyDeclarations: 0
  assembly: 
  generateAllTypes: 1
  types: []
  generateWrapper: 0
  overrideWrapperTypes: 0
  wrapperTypes: []
  WrapperFilters: []
  wrapperOutputDirectory: Generated
  compiledResult: '{"source":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\",
    { value: true });\r\nconst ZEPETO_Script_1 = require(\"ZEPETO.Script\");\r\nconst
    ZEPETO_Product_1 = require(\"ZEPETO.Product\");\r\nconst UnityEngine_1 = require(\"UnityEngine\");\r\nconst
    Manager_1 = require(\"../Manager/Manager\");\r\nconst ZEPETO_Currency_1 = require(\"ZEPETO.Currency\");\r\nconst
    Enums_1 = require(\"../Enums\");\r\nconst ZEPETO_Inventory_1 = require(\"ZEPETO.Inventory\");\r\nconst
    Connector_1 = require(\"./Connector\");\r\nconst index_1 = require(\"../Utils/index\");\r\nconst
    ZEPETO_World_1 = require(\"ZEPETO.World\");\r\nconst MyPlayerController_1 = require(\"../MyPlayerController/MyPlayerController\");\r\nclass
    ProductSync extends ZEPETO_Script_1.ZepetoScriptBehaviour {\r\n    Start() {\r\n       
    this.StartCoroutine(this.LoadAllItems()); //ItemsCache Product\r\n        //this.StartRefreshBalance();\r\n   
    }\r\n    *LoadAllItems() {\r\n        const request = ZEPETO_Product_1.ProductService.GetProductsAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    Manager_1.default.Product.ProductSyncinstance = this;\r\n        Manager_1.default.Product.SetMultiPlay(this.multiplay);\r\n       
    if (request.responseData.isSuccess) {\r\n            Manager_1.default.Product.ItemsCache
    = [];\r\n            request.responseData.products.forEach((pr) => {\r\n               
    if (pr.ProductType == ZEPETO_Product_1.ProductType.Item) {\r\n                   
    Manager_1.default.Product.ItemsCache.push(pr);\r\n                }\r\n               
    if (pr.ProductType == ZEPETO_Product_1.ProductType.ItemPackage) {\r\n                   
    Manager_1.default.Product.ItemsPackageCache.push(pr);\r\n                }\r\n               
    if (pr.ProductType == ZEPETO_Product_1.ProductType.CurrencyPackage) {\r\n                   
    Manager_1.default.Product.CurrencyPackageCache.push(pr);\r\n                }\r\n           
    });\r\n            if (Manager_1.default.Product.ItemsCache.length == 0) {\r\n               
    console.warn(''no Item information'');\r\n                return;\r\n           
    }\r\n        }\r\n        else {\r\n            console.warn(''Product Load Failed'');\r\n       
    }\r\n    }\r\n    *OnClickPurchaseItemImmediately(productId) {\r\n        const
    request = ZEPETO_Product_1.ProductService.PurchaseProductAsync(productId);\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            // is purchase success\r\n       
    }\r\n        else {\r\n            // is purchase fail\r\n        }\r\n    }\r\n   
    *RefreshBalance() {\r\n        const request = ZEPETO_Currency_1.CurrencyService.GetUserCurrencyBalancesAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            let g = request.responseData.currencies?.ContainsKey(Enums_1.Currency.Gold)\r\n               
    ? request.responseData.currencies?.get_Item(Enums_1.Currency.Gold).toString()\r\n               
    : ''0'';\r\n            MyPlayerController_1.default.Data.MyGold = Number(g);\r\n       
    }\r\n    }\r\n    *RefreshOfficialCurrencyUI() {\r\n        const request = ZEPETO_Currency_1.CurrencyService.GetOfficialCurrencyBalanceAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    let z = request.responseData.currency.quantity.toString();\r\n        MyPlayerController_1.default.Data.MyZem
    = Number(z);\r\n    }\r\n    StartRefreshBalance() {\r\n        this.StartCoroutine(this.RefreshBalance());\r\n       
    this.StartCoroutine(this.RefreshOfficialCurrencyUI());\r\n    }\r\n    StartRefreshInventory()
    {\r\n        this.StartCoroutine(this.RefreshInventory());\r\n    }\r\n    *RefreshInventory()
    {\r\n        const request = ZEPETO_Inventory_1.InventoryService.GetListAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            const items = request.responseData.products;\r\n           
    items.forEach((ir, index) => {\r\n                if (ir.productId.includes(''gun''))
    {\r\n                    let ind = Number(index_1.default.ExtractNumberStr(ir.productId));\r\n                   
    MyPlayerController_1.default.Data.MyWeaponInfoArr[ind - 1] = ''O'';\r\n               
    }\r\n            });\r\n            // items.forEach((ir, index) => {\r\n           
    //     // If there are zero consumable items, delete them from the inventory.\r\n           
    //     if (ir.quantity <= 0 && Manager.Product.ProductCache.get(ir.productId).PurchaseType
    == PurchaseType.Consumable) {\r\n            //         // remove inventory\r\n           
    //         const data = new RoomData();\r\n            //         data.Add(\"productId\",
    ir.productId);\r\n            //         Connector.Instance.ReqToServer(\"onRemoveInventory\",
    {productId: ir.productId});\r\n            //         return;\r\n           
    //     }\r\n            //\r\n            // });\r\n        }\r\n    }\r\n}\r\nexports.default
    = ProductSync;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJvZHVjdFN5bmMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJQcm9kdWN0U3luYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUFvRDtBQUNwRCxtREFBZ0c7QUFDaEcsNkNBQXNEO0FBQ3RELGdEQUF5QztBQUN6QyxxREFBZ0Q7QUFDaEQsb0NBQWtDO0FBQ2xDLHVEQUFtRTtBQUVuRSwyQ0FBb0M7QUFDcEMsMENBQW1DO0FBQ25DLCtDQUFrRDtBQUNsRCxpRkFBMEU7QUFFMUUsTUFBcUIsV0FBWSxTQUFRLHFDQUFxQjtJQUc1RCxLQUFLO1FBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDLG9CQUFvQjtRQUM5RCw2QkFBNkI7SUFDL0IsQ0FBQztJQUVPLENBQUMsWUFBWTtRQUNuQixNQUFNLE9BQU8sR0FBRywrQkFBYyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDbEQsTUFBTSxJQUFJLHVCQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsQ0FBQztRQUN4RCxpQkFBTyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7UUFDM0MsaUJBQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QyxJQUFJLE9BQU8sQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFO1lBQ2xDLGlCQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7WUFDaEMsT0FBTyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7Z0JBQzNDLElBQUksRUFBRSxDQUFDLFdBQVcsSUFBSSw0QkFBVyxDQUFDLElBQUksRUFBRTtvQkFDdEMsaUJBQU8sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FB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","assetPath":"Assets/Scripts/Client/Network/ProductSync.ts","manifest":{"properties":[{"assembly":"ZEPETO.World","name":"multiplay","type":"ZEPETO.World.ZepetoWorldMultiplay","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[]}],"name":"ProductSync","description":"","hasAnimatorMove":false},"isCompiled":true}'
  typescriptHash: 09acc5a7711373e70ee10eb129594122
  onlyWriteTrigger: 0
